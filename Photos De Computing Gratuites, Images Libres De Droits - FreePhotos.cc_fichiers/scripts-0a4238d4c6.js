$(document).ready(function(){function o(){$(".sponsor-container").length&&$(".sponsor-container").height($("#results-grid").height())}function t(){$(document).height()-s.height()<=s.scrollTop()+300?(a(!0),l=setTimeout(function(){t()},100)):clearTimeout(l)}function e(){u||(u=!0,$.ajax({type:"POST",url:window.loadMoreReferralUrl,data:{slice:g,slug:window.currentSearchQuery},success:function(o){if(u=!1,g++,o.length>0)for(i in o){var t='<div class="sponsor-grid-item" style="background-image: url('+o[i].previewUrl+"); height: "+Math.floor(o[i].height)+'px;"><a class="open-sponsor-image" href="'+o[i].link+'" target="_blank" rel="nofollow"></a></div>';$("#sponsor-end-of-list").before(t)}}}))}function a(t){return $(document).height()>s.height()&&!t?void clearTimeout(r):void(c||h||(c=!0,$("#loading").show(),$("#no-images").hide(),$.ajax({type:"POST",url:window.loadMoreUrl,data:{slice:d,slug:window.currentSearchQuery},success:function(t){if($("#loading").hide(),c=!1,d++,t.length>0)for(i in t){var e='<div class="grid-item"><a class="open-image" href="#" data-id="" data-author="" data-download=""></a>';void 0!=window.hideOverlay&&window.hideOverlay||(e+='<div class="overlay">',e+="500px"==t[i].provider?'<a href="#" class="download-btn" target="_blank" rel="nofollow"></a>':'<a href="" class="download-btn" download target="_blank"></a>',e+="</div>"),e+="</div>";var a=$(e),r=a.find("a.open-image"),l=a.find(".overlay a");void 0!==t[i].thumbUrl?a.css("background-image","url("+t[i].thumbUrl+")"):a.css("background-image","url("+t[i].previewUrl+")"),t[i].width>0&&t[i].height>0&&a.css("height",Math.floor(window.itemWidth*t[i].height/t[i].width)+"px"),void 0!=window.hideOverlay&&window.hideOverlay?(r.attr("href",t[i].link),r.attr("rel","nofollow")):r.attr("href","#"+t[i].id),r.attr("data-id",t[i].id),r.attr("data-author","local"!=t[i].provider?t[i].user+" @ "+t[i].provider:t[i].user),r.attr("data-download",t[i].imageUrl),t[i].link&&r.attr("data-link",t[i].link),l.attr("target","_blank"),l.attr("href",t[i].imageUrl),n.masonry().append(a).masonry("appended",a);var s=$(".lightbox:last").clone();s.length&&(s.attr("id",t[i].id),$(".lightbox-image",s).attr("data-image",t[i].previewUrl),$(".lightbox").last().after(s[0].outerHTML))}else h=!0,$("#no-images").show();o()}})))}window.location.href.split("#")[0]!=window.location.href&&(window.location.href=window.location.href.split("#")[0]),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var n=$(".grid").masonry({itemSelector:".grid-item",columnWidth:".grid-sizer",gutter:".gutter-sizer",percentPosition:!0,originLeft:!0});n.imagesLoaded().progress(function(){n.masonry("layout")}),$(".ham-menu").on("click",function(){$(".collapsed-menu").toggleClass("collapsed-menu-open")}),$(".trigger").on("click",function(){return $(".modal-wrapper").toggleClass("open"),$(".homepage").toggleClass("overflow-body"),!1}),$(document).on("click",".open-image",function(){var o=$(this).data("id");$(this).data("link")&&""!=$(this).data("link")?$(".lightbox-bottom .image-author").html("<a href='"+$(this).data("link")+"' target='_blank' rel='nofollow'>by "+$(this).data("author")+"</a>"):$(".lightbox-bottom .image-author").html("by "+$(this).data("author")),$(".lightbox-bottom .download-btn").attr("href",$(this).data("download"));var t=$("#"+o+" .lightbox-image").data("image");if($(".lightbox-bottom img").length)$(".lightbox-bottom img").attr("src",t);else{var e=$('<img src="'+t+'" alt=""/>');$("#"+o+" .lightbox-image").prepend(e)}}),$(document).on("touchstart",".lightbox",function(o){documentClick=!0}),$(document).on("touchmove",".lightbox",function(o){documentClick=!1}),$(document).on("click touchend",".lightbox",function(o){"click"==o.type&&(documentClick=!0),documentClick&&(window.location.href="#!")}),$(document).on("click touchstart",".download-btn, .image-author",function(o){o.stopPropagation()}),$(document).on("click",".download-btn",function(){if(Cookie.Read("downloadedLinks"))var o=Cookie.Read("downloadedLinks");else var o=0;return o<2&&!Cookie.Read("sharedLink")&&($(".thanks-modal-wrapper").addClass("open"),Cookie.Create("downloadedLinks",parseInt(o)+1,365)),!0}),$(document).on("click",".social-buttons a",function(){return Cookie.Create("sharedLink",!0,365),!0}),$(".close-modal-btn").on("click",function(){return $(".thanks-modal-wrapper").removeClass("open"),!1}),o();var r,l,d=2,s=$(window),c=!1,h=!1,u=!1,g=2;window.loadMoreUrl&&(s.scroll(function(){$(document).height()-s.height()<=s.scrollTop()+300&&a(!0),$("#sponsor-end-of-list").length&&$("#sponsor-end-of-list").offset().top-$(document).height()<=500&&e()}),r=setTimeout(function(){a(!1)},500)),t()});var Cookie={Create:function(o,t,e){var i="";if(e){var a=new Date;a.setTime(a.getTime()+24*e*60*60*1e3),i="; expires="+a.toGMTString()}document.cookie=o+"="+t+i+"; path=/"},Read:function(o){for(var t=o+"=",e=document.cookie.split(";"),i=0;i<e.length;i++){for(var a=e[i];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null},Erase:function(o){Cookie.create(o,"",-1)}};